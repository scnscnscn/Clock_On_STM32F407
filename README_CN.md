# STM32F407智能时钟与天气显示系统

[English](README.md) | 简体中文

## 📝 项目简介

这是一个基于STM32F407微控制器的智能时钟系统，集成了实时时钟显示、天气信息展示、多闹钟管理和触摸屏交互等功能。系统通过串口与外部设备通信获取天气数据，并在彩色LCD显示屏上实时展示。

## ✨ 主要功能

- **⏰ 实时时钟**: 精确的时间显示（时:分:秒）和日期管理
- **🌤️ 天气信息**: 实时温度、体感温度、湿度、降水量和天气图标
- **📅 多闹钟管理**: 支持4个独立可配置的闹钟
- **📱 触摸交互**: 直观的触摸屏操作界面
- **💬 串口通信**: 通过USART3获取天气数据
- **🔔 声光提示**: LED指示和蜂鸣器闹钟提醒

## 🛠️ 硬件要求

- **微控制器**: STM32F407ZGT6 (168MHz, 192KB RAM, 1MB Flash)
- **显示屏**: 480x800 TFT LCD带电容式触摸
- **通信**: USART3 (115200bps)
- **其他**: LED指示灯、蜂鸣器、按键

## 📂 项目结构

```
Clock_On_STM32F407/
├── User/                  # 用户应用代码
│   ├── main.c            # 主程序（核心业务逻辑）
│   ├── stm32f4xx_it.c   # 中断服务程序
│   └── *.h              # 图标和资源文件
├── BaseDrive/            # 基础驱动层
│   ├── Timer.c/h        # 定时器和闹钟管理
│   ├── USART.c/h        # 串口通信
│   ├── DEVICE.c/h       # LED和蜂鸣器
│   ├── KEY.c/h          # 按键驱动
│   ├── EXIT.c/h         # 外部中断
│   └── delay.c/h        # 延时函数
├── ExternalDrive/        # 外部设备驱动
│   ├── LCD/             # LCD显示驱动
│   └── TOUCH/           # 触摸屏驱动
├── Libraries/            # STM32标准外设库
├── 技术文档.md           # 详细技术文档（中文）
└── README_CN.md         # 本文件

```

## 🚀 快速开始

### 1. 开发环境

- **IDE**: Keil MDK-ARM V5.x 或 STM32CubeIDE
- **编译器**: ARM Compiler V5/V6
- **调试器**: ST-Link V2/V3
- **串口工具**: 任意串口调试助手

### 2. 编译步骤

1. 打开工程文件 `Clock.uvprojx` (Keil)
2. 选择目标芯片 STM32F407ZGT6
3. 设置优化级别为 -O2
4. 点击编译生成 .hex/.bin 文件

### 3. 烧录程序

使用ST-Link连接开发板，通过STM32 ST-LINK Utility或命令行工具烧录：

```bash
st-flash write output.bin 0x08000000
```

### 4. 串口配置

- **波特率**: 115200
- **数据位**: 8
- **停止位**: 1
- **校验位**: 无

## 💡 使用说明

### 主界面（PAGE_1）

主界面显示以下信息：
- 当前时间和日期
- 天气信息（温度、湿度、降水量）
- 天气图标
- 4个闹钟的状态列表

**操作**:
- 点击任一闹钟条目进入设置界面

### 设置界面（PAGE_2）

设置界面用于配置闹钟：
- 调整小时和分钟
- 启用/禁用闹钟
- 保存或取消修改

**按钮说明**:
- `小时+/-`: 调整小时
- `分钟+/-`: 调整分钟
- `启用/禁用`: 切换闹钟状态
- `保存`: 保存设置并返回
- `取消`: 放弃修改并返回

### 天气数据协议

系统通过串口接收天气数据，格式为：

```
时间|温度|体感|降水|代码|湿度
```

示例：
```
2025-12-27 14:30:00|25|26|0|100|60
```

## 📊 系统架构

详细的系统架构、模块说明、数据流程等请参阅 [技术文档.md](技术文档.md)。

## ⚙️ 配置说明

### 定时器配置 (TIM10)

- **时钟源**: 168MHz
- **预分频**: 167 (1MHz)
- **周期**: 9999 (100Hz, 10ms)
- **用途**: 时间片管理和闹钟系统

### 串口配置 (USART3)

- **引脚**: PC10(TX), PC11(RX)
- **波特率**: 115200
- **模式**: 8N1（8位数据，无校验，1位停止位）

### GPIO配置

| 外设 | 引脚 | 说明 |
|------|------|------|
| LED1-8 | PF0-7 | 状态指示 |
| 蜂鸣器 | PC13 | 闹钟提示 |
| 按键 | PF8 | 中断输入 |

## 🔧 常见问题

### LCD无显示

1. 检查LCD电源连接
2. 确认FSMC引脚配置正确
3. 检查背光控制引脚状态

### 触摸无响应

1. 检查I2C通信（SCL/SDA）
2. 确认触摸芯片I2C地址
3. 运行触摸屏校准程序

### 串口无数据

1. 确认波特率为115200
2. 检查TX/RX引脚连接
3. 确认外部设备正常发送数据

### 时间不准确

时间更新基于软件计数，存在累积误差。建议：
- 定期通过串口同步外部时间源
- 使用外部RTC芯片（DS1302/DS3231）

## 📈 性能指标

| 指标 | 数值 |
|------|------|
| RAM使用 | < 4KB |
| Flash使用 | ~970KB |
| 触摸响应 | < 100ms |
| 页面切换 | ~300ms |

## 🔮 未来计划

- [ ] 增加农历显示
- [ ] 接入实时天气API（WiFi模块）
- [ ] 支持多语言界面
- [ ] 添加语音播报功能
- [ ] 数据持久化存储（SD卡）
- [ ] 移植RTOS（FreeRTOS）

## 📄 许可证

本项目采用 MIT License 开源协议。

## �� 贡献

欢迎提交Issue和Pull Request！

## 📞 联系方式

- **项目仓库**: https://github.com/scnscnscn/Clock_On_STM32F407
- **问题反馈**: 请在GitHub Issues中提交

---

**最后更新**: 2025-12-27  
**版本**: 2.0
