#ifndef USART_H
#define USART_H

/********************************************************************************
 * @file    USART.h
 * @brief   STM32F4xx USART3串口驱动头文件
 * @author  WLQVincent@gmail.com
 * @date    2025-12-24
 * @note    1. 采用中断接收方式，通过结构体管理串口接收状态；
 *          2. 串口3硬件引脚为PC10(TX)、PC11(RX)，需与硬件原理图匹配；
 *          3. 接收完成通过超时判断实现，超时计数器由中断函数重置。
 ********************************************************************************/
#include "stdio.h"

/********************************************************************************
 * @brief   串口接收状态管理结构体
 * @details 用于存储串口3的接收缓冲区指针、已接收长度、超时计数和接收完成标志
 ********************************************************************************/
struct UsartData {
    unsigned char *Rxbuf;        /* 接收缓冲区指针，指向外部定义的存储数组 */
    unsigned int RXlenth;        /* 已接收数据的长度，由中断函数累加 */
    unsigned char Time;          /* 接收超时计数器，主循环中递减，中断中重置 */
    unsigned char ReceiveFinish; /* 接收完成标志：0-未完成，1-完成（超时触发） */
};
typedef struct UsartData USARTDATA; /* 结构体类型重定义，简化调用 */
typedef USARTDATA *PUSARTDATA;      /* 结构体指针类型重定义，用于指针传参 */

/********************************************************************************
 * @brief   全局串口3数据结构体实例
 * @details 供外部文件访问串口3的接收状态，需在.c文件中定义具体实例
 ********************************************************************************/
extern USARTDATA Uart3;

/********************************************************************************
 * @brief   初始化USART3的GPIO、串口参数和中断配置
 * @param   无
 * @retval  无
 * @note    1. 配置串口3为115200bps、8位数据位、1位停止位、无校验；
 *          2. 使能接收非空中断，中断优先级为抢占0、子优先级0；
 *          3. 需在主函数中先初始化系统时钟再调用此函数。
 ********************************************************************************/
void UART3_Configuration(void);

/********************************************************************************
 * @brief   USART3发送字节流数据
 * @param   Data: 待发送数据的起始地址指针（不可为NULL）
 * @param   length: 待发送数据的字节长度（需大于0）
 * @retval  无
 * @note    采用轮询方式发送，阻塞直到所有数据发送完成
 ********************************************************************************/
void USART3_Senddata(unsigned char *Data, unsigned int length);

#endif /* USART_H */